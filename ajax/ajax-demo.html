<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJAX Complete Demo - Interactive Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .section p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .demo-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .demo-card h3 {
            color: #333;
            margin-bottom: 12px;
            font-size: 1.3em;
        }

        .demo-card .use-case {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #1976d2;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .output.success {
            border-left: 4px solid #4caf50;
        }

        .output.error {
            border-left: 4px solid #f44336;
        }

        .output.info {
            border-left: 4px solid #2196f3;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            font-family: inherit;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: #4caf50;
            color: white;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.active {
            background: #4caf50;
            box-shadow: 0 0 8px #4caf50;
        }

        .status-indicator.inactive {
            background: #999;
        }

        .search-results {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .search-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-item:hover {
            background: #f5f5f5;
        }

        .search-item:last-child {
            border-bottom: none;
        }

        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e91e63;
        }

        .tip {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .tip strong {
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AJAX Interactive Learning Lab</h1>
            <p>Learn by doing - Click buttons to see AJAX in action!</p>
        </div>

        <div class="content">
            <!-- Section 1: Basic GET Request -->
            <div class="section">
                <h2>1. Basic GET Request</h2>
                <p>Fetch data from a server without reloading the page.</p>

                <div class="demo-grid">
                    <div class="demo-card">
                        <h3>Fetch API (Modern)</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Loading user profiles, product lists, blog posts
                        </div>
                        <button onclick="fetchUsers()">Fetch Users</button>
                        <div id="fetch-output" class="output" style="display:none;"></div>
                    </div>

                    <div class="demo-card">
                        <h3>Async/Await (Cleanest)</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Any modern application - most readable syntax
                        </div>
                        <button onclick="asyncFetchUsers()">Fetch Users (Async)</button>
                        <div id="async-output" class="output" style="display:none;"></div>
                    </div>

                    <div class="demo-card">
                        <h3>XMLHttpRequest (Legacy)</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Old browser support, progress tracking
                        </div>
                        <button onclick="xhrFetchUsers()">Fetch Users (XHR)</button>
                        <div id="xhr-output" class="output" style="display:none;"></div>
                    </div>
                </div>
            </div>

            <!-- Section 2: POST Request -->
            <div class="section">
                <h2>2. POST Request - Creating Data</h2>
                <p>Send data to the server to create new resources.</p>

                <div class="demo-card">
                    <h3>Create New Post</h3>
                    <div class="use-case">
                        <strong>Real-World Use:</strong> User registration, creating blog posts, submitting forms
                    </div>
                    <input type="text" id="post-title" placeholder="Post Title">
                    <textarea id="post-body" placeholder="Post Content" rows="3"></textarea>
                    <button onclick="createPost()">Create Post</button>
                    <div id="post-output" class="output" style="display:none;"></div>
                </div>
            </div>

            <!-- Section 3: PUT & PATCH -->
            <div class="section">
                <h2>3. Update Requests - PUT vs PATCH</h2>
                <p><code>PUT</code> = Replace entire resource | <code>PATCH</code> = Update specific fields</p>

                <div class="demo-grid">
                    <div class="demo-card">
                        <h3>PUT - Full Update</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Updating entire user profile, replacing document
                        </div>
                        <button onclick="updatePostPUT()">Update Entire Post</button>
                        <div id="put-output" class="output" style="display:none;"></div>
                    </div>

                    <div class="demo-card">
                        <h3>PATCH - Partial Update</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Updating just email, changing avatar, toggling settings
                        </div>
                        <button onclick="updatePostPATCH()">Update Title Only</button>
                        <div id="patch-output" class="output" style="display:none;"></div>
                    </div>
                </div>
            </div>

            <!-- Section 4: DELETE -->
            <div class="section">
                <h2>4. DELETE Request</h2>
                <p>Remove resources from the server.</p>

                <div class="demo-card">
                    <h3>Delete Resource</h3>
                    <div class="use-case">
                        <strong>Real-World Use:</strong> Deleting posts, removing items from cart, canceling orders
                    </div>
                    <button onclick="deletePost()">Delete Post #1</button>
                    <div id="delete-output" class="output" style="display:none;"></div>
                </div>
            </div>

            <!-- Section 5: Error Handling -->
            <div class="section">
                <h2>5. Error Handling</h2>
                <p>Proper error handling is crucial for production apps.</p>

                <div class="demo-grid">
                    <div class="demo-card">
                        <h3>404 Error</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Handling missing resources, invalid IDs
                        </div>
                        <button onclick="handle404()">Trigger 404 Error</button>
                        <div id="error-404" class="output" style="display:none;"></div>
                    </div>

                    <div class="demo-card">
                        <h3>Network Error</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Offline detection, server down scenarios
                        </div>
                        <button onclick="handleNetworkError()">Trigger Network Error</button>
                        <div id="error-network" class="output" style="display:none;"></div>
                    </div>

                    <div class="demo-card">
                        <h3>Retry Logic</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Unstable connections, temporary server issues
                        </div>
                        <button onclick="testRetry()">Test Retry (3 attempts)</button>
                        <div id="retry-output" class="output" style="display:none;"></div>
                    </div>
                </div>
            </div>

            <!-- Section 6: Parallel vs Sequential -->
            <div class="section">
                <h2>6. Parallel vs Sequential Requests</h2>
                <p>Understanding when to use <code>Promise.all()</code> vs sequential requests.</p>

                <div class="demo-grid">
                    <div class="demo-card">
                        <h3>Parallel Requests</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Loading independent data (users + posts + comments)
                        </div>
                        <button onclick="parallelRequests()">Load 3 Resources (Parallel)</button>
                        <div id="parallel-output" class="output" style="display:none;"></div>
                    </div>

                    <div class="demo-card">
                        <h3>Sequential Requests</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> When data depends on previous response
                        </div>
                        <button onclick="sequentialRequests()">Load User ‚Üí Posts ‚Üí Comments</button>
                        <div id="sequential-output" class="output" style="display:none;"></div>
                    </div>
                </div>
            </div>

            <!-- Section 7: Search with Debouncing -->
            <div class="section">
                <h2>7. Search Autocomplete (Debouncing)</h2>
                <p>Prevent excessive API calls while user is typing.</p>

                <div class="demo-card">
                    <h3>Live Search Demo</h3>
                    <div class="use-case">
                        <strong>Real-World Use:</strong> Search bars, autocomplete, live filtering
                    </div>
                    <div class="tip">
                        <strong>Tip:</strong> Notice how it waits 300ms after you stop typing before making a request!
                    </div>
                    <input type="text" id="search-input" placeholder="Search users... (try typing 'Leanne')">
                    <div id="search-results" class="search-results" style="display:none;"></div>
                    <div id="search-status" style="margin-top:10px; color:#666;"></div>
                </div>
            </div>

            <!-- Section 8: Request Timeout & Cancellation -->
            <div class="section">
                <h2>8. Request Timeout & Cancellation</h2>
                <p>Handle slow requests and allow users to cancel ongoing requests.</p>

                <div class="demo-grid">
                    <div class="demo-card">
                        <h3>Request Timeout</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Prevent hanging requests, set time limits
                        </div>
                        <button onclick="testTimeout()">Fetch with 5s Timeout</button>
                        <div id="timeout-output" class="output" style="display:none;"></div>
                    </div>

                    <div class="demo-card">
                        <h3>Cancellable Request</h3>
                        <div class="use-case">
                            <strong>Real-World Use:</strong> Cancel button, navigation away, tab switching
                        </div>
                        <button onclick="startCancellableRequest()" id="start-cancel">Start Long Request</button>
                        <button onclick="cancelRequest()" id="cancel-btn" disabled>Cancel Request</button>
                        <div id="cancel-output" class="output" style="display:none;"></div>
                    </div>
                </div>
            </div>

            <!-- Section 9: Headers & Authentication -->
            <div class="section">
                <h2>9. Custom Headers & Authentication</h2>
                <p>Send custom headers, authentication tokens, and API keys.</p>

                <div class="demo-card">
                    <h3>Request with Custom Headers</h3>
                    <div class="use-case">
                        <strong>Real-World Use:</strong> JWT auth, API keys, content negotiation
                    </div>
                    <button onclick="fetchWithHeaders()">Fetch with Custom Headers</button>
                    <div id="headers-output" class="output" style="display:none;"></div>
                </div>
            </div>

            <!-- Section 10: Caching -->
            <div class="section">
                <h2>10. Caching Strategy</h2>
                <p>Improve performance by caching API responses.</p>

                <div class="demo-card">
                    <h3>Cache Demo (60s TTL)</h3>
                    <div class="use-case">
                        <strong>Real-World Use:</strong> Reduce server load, faster response times, offline support
                    </div>
                    <div class="tip">
                        <strong>Tip:</strong> Click multiple times - first request fetches from server, subsequent ones use cache!
                    </div>
                    <button onclick="fetchWithCache()">Fetch Users (Cached)</button>
                    <button onclick="clearCache()">Clear Cache</button>
                    <div id="cache-output" class="output" style="display:none;"></div>
                </div>
            </div>

            <!-- Section 11: File Upload Simulation -->
            <div class="section">
                <h2>11. File Upload with Progress</h2>
                <p>Track upload progress for better user experience.</p>

                <div class="demo-card">
                    <h3>Upload Simulation</h3>
                    <div class="use-case">
                        <strong>Real-World Use:</strong> Profile pictures, document uploads, media files
                    </div>
                    <button onclick="simulateFileUpload()">Simulate File Upload</button>
                    <div class="progress-bar" id="upload-progress-bar" style="display:none;">
                        <div class="progress-fill" id="upload-progress-fill">0%</div>
                    </div>
                    <div id="upload-output" class="output" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===================================================================
        // IMPLEMENTATIONS
        // ===================================================================

        // 1. Basic GET - Fetch API
        function fetchUsers() {
            const output = document.getElementById('fetch-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Loading...';

            fetch('https://jsonplaceholder.typicode.com/users')
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return response.json();
                })
                .then(users => {
                    output.className = 'output success';
                    output.textContent = `‚úÖ Success! Loaded ${users.length} users:\n\n` +
                        JSON.stringify(users.slice(0, 3), null, 2) +
                        '\n\n... and ' + (users.length - 3) + ' more';
                })
                .catch(error => {
                    output.className = 'output error';
                    output.textContent = '‚ùå Error: ' + error.message;
                });
        }

        // 2. Async/Await GET
        async function asyncFetchUsers() {
            const output = document.getElementById('async-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Loading with async/await...';

            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/users');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const users = await response.json();
                output.className = 'output success';
                output.textContent = `‚úÖ Async Success! ${users.length} users loaded.\n\n` +
                    'First user:\n' + JSON.stringify(users[0], null, 2);
            } catch (error) {
                output.className = 'output error';
                output.textContent = '‚ùå Error: ' + error.message;
            }
        }

        // 3. XMLHttpRequest GET
        function xhrFetchUsers() {
            const output = document.getElementById('xhr-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Loading with XMLHttpRequest...';

            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://jsonplaceholder.typicode.com/users', true);

            xhr.onload = function() {
                if (xhr.status === 200) {
                    const users = JSON.parse(xhr.responseText);
                    output.className = 'output success';
                    output.textContent = `‚úÖ XHR Success! Loaded ${users.length} users.\n\n` +
                        'Using classic XMLHttpRequest method.';
                } else {
                    output.className = 'output error';
                    output.textContent = '‚ùå Error: ' + xhr.status;
                }
            };

            xhr.onerror = function() {
                output.className = 'output error';
                output.textContent = '‚ùå Network Error';
            };

            xhr.send();
        }

        // 4. POST Request
        async function createPost() {
            const title = document.getElementById('post-title').value;
            const body = document.getElementById('post-body').value;
            const output = document.getElementById('post-output');

            if (!title || !body) {
                alert('Please fill in both title and body!');
                return;
            }

            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Creating post...';

            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        body: body,
                        userId: 1
                    })
                });

                const data = await response.json();
                output.className = 'output success';
                output.textContent = '‚úÖ Post Created Successfully!\n\n' +
                    JSON.stringify(data, null, 2);

                // Clear inputs
                document.getElementById('post-title').value = '';
                document.getElementById('post-body').value = '';
            } catch (error) {
                output.className = 'output error';
                output.textContent = '‚ùå Error: ' + error.message;
            }
        }

        // 5. PUT Request
        async function updatePostPUT() {
            const output = document.getElementById('put-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Updating entire post with PUT...';

            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: 1,
                        title: 'Updated: Complete Post Replacement',
                        body: 'This is the new content - entire resource replaced',
                        userId: 1
                    })
                });

                const data = await response.json();
                output.className = 'output success';
                output.textContent = '‚úÖ PUT Success! Entire post replaced:\n\n' +
                    JSON.stringify(data, null, 2);
            } catch (error) {
                output.className = 'output error';
                output.textContent = '‚ùå Error: ' + error.message;
            }
        }

        // 6. PATCH Request
        async function updatePostPATCH() {
            const output = document.getElementById('patch-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Updating title only with PATCH...';

            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1', {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: 'Updated: Title Only (PATCH)'
                    })
                });

                const data = await response.json();
                output.className = 'output success';
                output.textContent = '‚úÖ PATCH Success! Only title updated:\n\n' +
                    JSON.stringify(data, null, 2);
            } catch (error) {
                output.className = 'output error';
                output.textContent = '‚ùå Error: ' + error.message;
            }
        }

        // 7. DELETE Request
        async function deletePost() {
            const output = document.getElementById('delete-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Deleting post...';

            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1', {
                    method: 'DELETE'
                });

                if (response.ok) {
                    output.className = 'output success';
                    output.textContent = '‚úÖ DELETE Success! Post removed.\n\n' +
                        'Status: ' + response.status + '\n' +
                        'Note: JSONPlaceholder is a fake API, so data is not actually deleted.';
                }
            } catch (error) {
                output.className = 'output error';
                output.textContent = '‚ùå Error: ' + error.message;
            }
        }

        // 8. Error Handling - 404
        async function handle404() {
            const output = document.getElementById('error-404');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Requesting non-existent resource...';

            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/999999');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: Resource not found`);
                }

                const data = await response.json();
            } catch (error) {
                output.className = 'output error';
                output.textContent = '‚ùå Caught Error:\n\n' +
                    error.message + '\n\n' +
                    'This is how you handle missing resources in production.';
            }
        }

        // 9. Network Error
        async function handleNetworkError() {
            const output = document.getElementById('error-network');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Requesting invalid URL...';

            try {
                const response = await fetch('https://this-domain-does-not-exist-12345.com/api');
                const data = await response.json();
            } catch (error) {
                output.className = 'output error';
                output.textContent = '‚ùå Network Error Caught:\n\n' +
                    error.message + '\n\n' +
                    'Type: ' + error.name + '\n\n' +
                    'This happens when: offline, server down, DNS failure, CORS issues';
            }
        }

        // 10. Retry Logic
        async function testRetry() {
            const output = document.getElementById('retry-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Starting retry attempts...\n';

            let attempt = 0;
            const maxRetries = 3;
            const delay = 1000;

            async function tryFetch() {
                attempt++;
                output.textContent += `\nAttempt ${attempt}/${maxRetries}...`;

                try {
                    // Simulating failure by requesting invalid endpoint
                    const response = await fetch('https://jsonplaceholder.typicode.com/invalid');
                    if (!response.ok) throw new Error('Failed');
                    return await response.json();
                } catch (error) {
                    output.textContent += ` ‚ùå Failed`;

                    if (attempt < maxRetries) {
                        output.textContent += `\nWaiting ${delay}ms before retry...`;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return tryFetch();
                    } else {
                        output.className = 'output error';
                        output.textContent += '\n\n‚ùå All retries exhausted.\n' +
                            'In production, you would show error to user or use exponential backoff.';
                        throw error;
                    }
                }
            }

            tryFetch();
        }

        // 11. Parallel Requests
        async function parallelRequests() {
            const output = document.getElementById('parallel-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Loading 3 resources in parallel...\n‚è±Ô∏è Timer started...';

            const startTime = Date.now();

            try {
                const [users, posts, comments] = await Promise.all([
                    fetch('https://jsonplaceholder.typicode.com/users').then(r => r.json()),
                    fetch('https://jsonplaceholder.typicode.com/posts').then(r => r.json()),
                    fetch('https://jsonplaceholder.typicode.com/comments').then(r => r.json())
                ]);

                const duration = Date.now() - startTime;

                output.className = 'output success';
                output.textContent = `‚úÖ All resources loaded in ${duration}ms!\n\n` +
                    `Users: ${users.length}\n` +
                    `Posts: ${posts.length}\n` +
                    `Comments: ${comments.length}\n\n` +
                    'All requests executed simultaneously - fastest approach for independent data!';
            } catch (error) {
                output.className = 'output error';
                output.textContent = '‚ùå Error: ' + error.message;
            }
        }

        // 12. Sequential Requests
        async function sequentialRequests() {
            const output = document.getElementById('sequential-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Step 1: Loading user...\n';

            const startTime = Date.now();

            try {
                // Step 1: Get user
                const userResponse = await fetch('https://jsonplaceholder.typicode.com/users/1');
                const user = await userResponse.json();
                output.textContent += `‚úÖ User loaded: ${user.name}\n\n`;

                // Step 2: Get posts for that user
                output.textContent += 'Step 2: Loading user\'s posts...\n';
                const postsResponse = await fetch(`https://jsonplaceholder.typicode.com/posts?userId=${user.id}`);
                const posts = await postsResponse.json();
                output.textContent += `‚úÖ ${posts.length} posts loaded\n\n`;

                // Step 3: Get comments for first post
                output.textContent += 'Step 3: Loading comments for first post...\n';
                const commentsResponse = await fetch(`https://jsonplaceholder.typicode.com/comments?postId=${posts[0].id}`);
                const comments = await commentsResponse.json();

                const duration = Date.now() - startTime;

                output.className = 'output success';
                output.textContent += `‚úÖ ${comments.length} comments loaded\n\n` +
                    `Total time: ${duration}ms\n\n` +
                    'Used when each request depends on the previous response.';
            } catch (error) {
                output.className = 'output error';
                output.textContent += '\n‚ùå Error: ' + error.message;
            }
        }

        // 13. Search with Debouncing
        let debounceTimer;
        let searchController;

        document.getElementById('search-input')?.addEventListener('input', function(e) {
            const query = e.target.value;
            const status = document.getElementById('search-status');
            const results = document.getElementById('search-results');

            if (query.length < 2) {
                results.style.display = 'none';
                status.textContent = '';
                return;
            }

            status.textContent = '‚åõ Waiting for you to stop typing...';

            // Cancel previous request
            if (searchController) {
                searchController.abort();
            }

            // Clear previous timer
            clearTimeout(debounceTimer);

            // Set new timer
            debounceTimer = setTimeout(async () => {
                status.textContent = 'üîç Searching...';
                searchController = new AbortController();

                try {
                    const response = await fetch(
                        `https://jsonplaceholder.typicode.com/users?q=${query}`,
                        { signal: searchController.signal }
                    );
                    const users = await response.json();

                    // Filter results locally (since API doesn't support search)
                    const filtered = users.filter(u =>
                        u.name.toLowerCase().includes(query.toLowerCase()) ||
                        u.email.toLowerCase().includes(query.toLowerCase())
                    );

                    if (filtered.length > 0) {
                        results.innerHTML = filtered.map(user =>
                            `<div class="search-item">${user.name} - ${user.email}</div>`
                        ).join('');
                        results.style.display = 'block';
                        status.textContent = `‚úÖ Found ${filtered.length} result(s)`;
                    } else {
                        results.style.display = 'none';
                        status.textContent = '‚ùå No results found';
                    }
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        status.textContent = '‚ùå Search error: ' + error.message;
                    }
                }
            }, 300); // 300ms delay
        });

        // 14. Timeout
        async function testTimeout() {
            const output = document.getElementById('timeout-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Starting request with 5 second timeout...\n';

            const controller = new AbortController();
            const timeoutId = setTimeout(() => {
                controller.abort();
                output.textContent += '‚è±Ô∏è Timeout triggered!\n';
            }, 5000);

            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/users', {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                const data = await response.json();

                output.className = 'output success';
                output.textContent += `‚úÖ Request completed before timeout!\n` +
                    `Loaded ${data.length} users`;
            } catch (error) {
                if (error.name === 'AbortError') {
                    output.className = 'output error';
                    output.textContent += '‚ùå Request aborted due to timeout\n\n' +
                        'In production, show retry option or error message to user.';
                } else {
                    output.className = 'output error';
                    output.textContent += '‚ùå Error: ' + error.message;
                }
            }
        }

        // 15. Cancellable Request
        let cancelController;

        async function startCancellableRequest() {
            const output = document.getElementById('cancel-output');
            const startBtn = document.getElementById('start-cancel');
            const cancelBtn = document.getElementById('cancel-btn');

            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Starting request...\nClick "Cancel Request" to abort\n\n';

            cancelController = new AbortController();
            startBtn.disabled = true;
            cancelBtn.disabled = false;

            try {
                // Simulating long request
                output.textContent += 'Fetching large dataset...\n';
                const response = await fetch('https://jsonplaceholder.typicode.com/photos', {
                    signal: cancelController.signal
                });

                const data = await response.json();
                output.className = 'output success';
                output.textContent += `\n‚úÖ Request completed! Loaded ${data.length} items`;
            } catch (error) {
                if (error.name === 'AbortError') {
                    output.className = 'output error';
                    output.textContent += '‚ùå Request cancelled by user!\n\n' +
                        'Use case: User navigates away, closes modal, or clicks cancel button.';
                } else {
                    output.className = 'output error';
                    output.textContent += '‚ùå Error: ' + error.message;
                }
            } finally {
                startBtn.disabled = false;
                cancelBtn.disabled = true;
            }
        }

        function cancelRequest() {
            if (cancelController) {
                cancelController.abort();
            }
        }

        // 16. Custom Headers
        async function fetchWithHeaders() {
            const output = document.getElementById('headers-output');
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Sending request with custom headers...\n\n';

            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/users', {
                    headers: {
                        'Authorization': 'Bearer fake-jwt-token-12345',
                        'X-Custom-Header': 'CustomValue',
                        'Accept': 'application/json',
                        'User-Agent': 'AJAX-Learning-Lab'
                    }
                });

                const data = await response.json();

                output.textContent += 'Request Headers Sent:\n';
                output.textContent += '- Authorization: Bearer fake-jwt-token-12345\n';
                output.textContent += '- X-Custom-Header: CustomValue\n';
                output.textContent += '- Accept: application/json\n\n';

                output.textContent += 'Response Headers Received:\n';
                output.textContent += `- Content-Type: ${response.headers.get('Content-Type')}\n`;
                output.textContent += `- Date: ${response.headers.get('Date')}\n\n`;

                output.className = 'output success';
                output.textContent += `‚úÖ Loaded ${data.length} users with custom headers`;
            } catch (error) {
                output.className = 'output error';
                output.textContent += '‚ùå Error: ' + error.message;
            }
        }

        // 17. Caching
        const cache = new Map();
        const CACHE_TTL = 60000; // 60 seconds

        async function fetchWithCache() {
            const output = document.getElementById('cache-output');
            output.style.display = 'block';
            output.className = 'output info';

            const url = 'https://jsonplaceholder.typicode.com/users';
            const cached = cache.get(url);

            if (cached && Date.now() - cached.timestamp < CACHE_TTL) {
                output.className = 'output success';
                output.textContent = 'üì¶ Returning CACHED data (no API call made)\n\n' +
                    `Cached at: ${new Date(cached.timestamp).toLocaleTimeString()}\n` +
                    `Data: ${cached.data.length} users\n\n` +
                    'Cache expires in: ' + Math.round((CACHE_TTL - (Date.now() - cached.timestamp)) / 1000) + ' seconds';
                return;
            }

            output.textContent = 'üåê Fetching FRESH data from API...\n';

            try {
                const response = await fetch(url);
                const data = await response.json();

                cache.set(url, {
                    data: data,
                    timestamp: Date.now()
                });

                output.className = 'output success';
                output.textContent = '‚úÖ Fresh data loaded and cached!\n\n' +
                    `Loaded: ${data.length} users\n` +
                    `Cached at: ${new Date().toLocaleTimeString()}\n\n` +
                    'Click again within 60 seconds to see cached response!';
            } catch (error) {
                output.className = 'output error';
                output.textContent = '‚ùå Error: ' + error.message;
            }
        }

        function clearCache() {
            cache.clear();
            const output = document.getElementById('cache-output');
            output.style.display = 'block';
            output.className = 'output success';
            output.textContent = 'üóëÔ∏è Cache cleared! Next request will fetch fresh data.';
        }

        // 18. File Upload Simulation
        function simulateFileUpload() {
            const progressBar = document.getElementById('upload-progress-bar');
            const progressFill = document.getElementById('upload-progress-fill');
            const output = document.getElementById('upload-output');

            progressBar.style.display = 'block';
            output.style.display = 'block';
            output.className = 'output info';
            output.textContent = 'Uploading file...\n';

            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressFill.style.width = progress + '%';
                progressFill.textContent = progress + '%';

                if (progress >= 100) {
                    clearInterval(interval);
                    output.className = 'output success';
                    output.textContent = '‚úÖ File uploaded successfully!\n\n' +
                        'In real implementation, use:\n' +
                        '- FormData for file uploads\n' +
                        '- XMLHttpRequest for progress tracking\n' +
                        '- Or libraries like Axios';

                    setTimeout(() => {
                        progressBar.style.display = 'none';
                        progressFill.style.width = '0%';
                    }, 2000);
                }
            }, 200);
        }

        console.log('‚úÖ AJAX Interactive Demo Ready!');
        console.log('üí° Click buttons to see AJAX in action!');
    </script>
</body>
</html>
